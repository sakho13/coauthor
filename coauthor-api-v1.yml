openapi: "3.0.3"
info:
  title: CoAuthor API
  version: "1.0"
servers:
  - url: http://localhost:3000/api
    description: Local server
tags:
  - name: InDevelopment
    description: "開発中"

paths:
  /v1/user:
    get:
      summary: ユーザ情報の取得
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      email:
                        type: string
                      createdAt:
                        $ref: "#/components/schemas/CreatedAt"
                      updatedAt:
                        $ref: "#/components/schemas/UpdatedAt"
    post:
      summary: ユーザ情報の登録
      description: ユーザ登録のタイミングで実行される。<br>
        登録のタイミングで失敗した場合、ログイン画面から再登録を促す。
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      email:
                        type: string
                  status:
                    type: string
                    enum:
                      - EXISTS
                      - CREATED
    patch:
      summary: ユーザ情報の更新
      tags:
        - InDevelopment
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  nullable: true
      responses:
        "200":
          description: OK<br>
            現在のユーザ情報をすべて返却する。
          content:
            application/json:
              schema:
                type: object
                properties:
                  user:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                      email:
                        type: string

  /v1/user/history:
    get:
      summary: ユーザ作業履歴の取得
      tags:
        - InDevelopment
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object

  /v1/novel:
    post:
      summary: 小説情報マスタの登録
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                summary:
                  type: string
                novelType:
                  type: string
                  enum:
                    - 0
                    - 1
                  description: "0: 連載, 1: 短編"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  novel:
                    $ref: "#/components/schemas/CoAuthor_Novel"
    delete:
      summary: 小説情報マスタの削除
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                novelId:
                  type: string
                code:
                  type: string
                  description: "削除コード（novelIdの先頭4文字）"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  novelId:
                    type: string

  /v1/novels:
    get:
      summary: 登録済み小説リストの取得
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  novels:
                    type: array
                    items:
                      $ref: "#/components/schemas/CoAuthor_Novel_AppendedDate"

  /v1/novel/chapter/content:
    get:
      summary: 小説章の内容取得
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
        - name: novel_id
          in: query
          required: true
          schema:
            type: string
        - name: order
          in: query
          required: true
          schema:
            type: integer
            minimum: 1
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  chapter:
                    type: object
                    properties:
                      novelId:
                        type: string
                      title:
                        type: string
                        description: 章タイトル
                      chapterId:
                        type: string
                      content:
                        type: string
                        maxLength: 70000
    post:
      summary: 小説章の内容登録
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                novelId:
                  type: string
                chapterId:
                  type: string
                content:
                  type: string
                  maxLength: 70000
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  novelId:
                    type: string
                  chapterId:
                    type: string

  /v1/novel/chapters:
    get:
      summary: 小説章リストの取得
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
        - name: novel_id
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  novel:
                    $ref: "#/components/schemas/CoAuthor_Novel_AppendedDate"
                  chapters:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        order:
                          type: integer
                        title:
                          type: string
                        createdAt:
                          $ref: "#/components/schemas/CreatedAt"
                        updatedAt:
                          $ref: "#/components/schemas/UpdatedAt"
    post:
      summary: 小説章の順序更新
      parameters:
        - $ref: "#/components/parameters/AuthorizationHeader"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                novelId:
                  type: string
                orders:
                  type: array
                  items:
                    type: object
                    properties:
                      chapterId:
                        type: string
                      order:
                        type: integer
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  chapters:
                    type: array
                    items:
                      type: object
                      properties:
                        id:
                          type: string
                        order:
                          type: integer
                        title:
                          type: string

components:
  schemas:
    CreatedAt:
      type: string
      format: date-time
      description: Timezone = UTC (ISO8601)
      example: "2021-01-01T00:00:00.123Z"
    UpdatedAt:
      type: string
      format: date-time
      description: Timezone = UTC (ISO8601)
      example: "2021-01-01T00:00:00.987Z"
    ApiV1ErrorOut:
      type: object
      properties:
        code:
          type: string
        message:
          type: string
        columns:
          type: array
          items:
            $ref: "#/components/schemas/ApiV1ErrorOutColumn"
    ApiV1ErrorOutColumn:
      type: object
      properties:
        name:
          type: string
        message:
          type: string
    CoAuthor_Novel:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        summary:
          type: string
        novelType:
          type: string
          enum:
            - SERIAL
            - SINGLE
          description: "SERIAL: 連載, SINGLE: 短編"
    CoAuthor_Novel_AppendedDate:
      type: object
      properties:
        id:
          type: string
        title:
          type: string
        summary:
          type: string
        novelType:
          type: string
          enum:
            - SERIAL
            - SINGLE
          description: "SERIAL: 連載, SINGLE: 短編"
        updatedAt:
          $ref: "#/components/schemas/UpdatedAt"
        createdAt:
          $ref: "#/components/schemas/CreatedAt"
    CoAuthor_NovelChapter:
      type: object
      properties:
        id:
          type: string
        order:
          type: integer
        title:
          type: string
        content:
          type: string
    CoAuthor_NovelChapter_AppendedDate:
      type: object
      properties:
        id:
          type: string
        order:
          type: integer
        title:
          type: string
        content:
          type: string
        updatedAt:
          $ref: "#/components/schemas/UpdatedAt"
        createdAt:
          $ref: "#/components/schemas/CreatedAt"

  parameters:
    AuthorizationHeader:
      name: Authorization
      in: header
      required: true
      description: Authorization token
      schema:
        type: string
        description: Bearer token
